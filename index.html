<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Example on how to use Marker Clusterer Plus and Overlapping Marker Spiderfier</title>
    <meta name="description" content="Example on how to use Marker Clusterer Plus and Overlapping Marker Spiderfier">
    <meta name="author" content="Yago Ferrer">

    <style>
        body {
            margin: 0;
            padding: 10px 20px 20px;
            font-family: Arial;
            font-size: 16px;
        }

        #map-container {
            padding: 6px;
            border-width: 1px;
            border-style: solid;
            border-color: #ccc #ccc #999 #ccc;
            width: 800px;
        }

        #map {
            width: 800px;
            height: 600px;
        }

    </style>

</head>

<body>

<div id="map-container">
    <div id="map"></div>
</div>


<script src="http://maps.googleapis.com/maps/api/js?v=3.16&sensor=false"></script>
<script src="bower_components/gmaps/gmaps.js"></script>
<script src="bower_components/gmaps-markerclusterer-plus/src/markerclusterer.js"></script>
<script src="bower_components/OverlappingMarkerSpiderfier/oms.js"></script>



<script>


    data = [
        {lat: 37.4419, lon: -122.1419, title: "Marker same location 1"},
        {lat: 37.4419, lon: -122.1419, title: "Marker same location 2"},
        {lat: 37.4419, lon: -122.1419, title: "Marker same location 3"},
        {lat: 37.4419, lon: -122.1419, title: "Marker same location 4"},
        {lat: 37.4419, lon: -122.1419, title: "Marker same location 5"},
        {lat: 37.4419, lon: -122.1380, title: "Marker close by 1"},
    ]



    var minClusterZoom = 15;

    function initialize() {

        var center = new google.maps.LatLng(37.4419, -122.1419);

        var gm = google.maps;

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 6,
            center: center,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var oms = new OverlappingMarkerSpiderfier(map);

        var markers = [];

        for (var x in data) {

            var loc = new gm.LatLng(data[x].lat, data[x].lon);

            var marker = new gm.Marker({
                position: loc,
                title: data[x].title,
                map: map
            });

            marker.desc = data[x].title;

            markers.push(marker); // Saving Markers

            oms.addMarker(marker);  // <-- here
        }



        var iw = new gm.InfoWindow();

        oms.addListener('click', function(marker, event) {
            iw.setContent(marker.title);
            iw.open(map, marker);
        });

        oms.addListener('spiderfy', function(markers) {
            iw.close();
        });



        var markerCluster = new MarkerClusterer(map, markers);

        markerCluster.setMaxZoom(minClusterZoom);


    }


    google.maps.event.addDomListener(window, 'load', initialize);


</script>


</body>
</html>